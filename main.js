(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t,e,n,o){var r=u.querySelector(".card").cloneNode(!0),c=r.querySelector(".card__image"),a=r.querySelector(".card__title"),i=r.querySelector(".card__delete-button"),l=r.querySelector(".card__like-button"),s=r.querySelector(".card__like-counter");return c.alt=t.name,c.src=t.link,a.textContent=t.name,c.addEventListener("click",(function(){e(t.link,t.name,t.name)})),i.addEventListener("click",(function(){!function(t,e){fetch("https://nomoreparties.co/v1/wff-cohort-8/cards/".concat(t),{method:"DELETE",headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c"}}).then((function(t){if(!t.ok)throw new Error("Не удалось удалить карту: ".concat(t.status));e.remove()})).catch((function(t){console.error("Ошибка удаления карты:",t)}))}(t._id,r)})),t.owner._id===n?i.style.display="block":i.style.display="none",t.likes.some((function(t){return t._id===n}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){!function(t,e,n){var o=e.classList.contains("card__like-button_is-active"),r=o?"DELETE":"PUT";fetch("https://nomoreparties.co/v1/wff-cohort-8/cards/likes/".concat(t),{method:r,headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c"}}).then((function(t){if(!t.ok)throw new Error("Не удалось ".concat(o?"убрать лайк":"поставить лайк"," карточке: ").concat(t.status));return t.json()})).then((function(t){e.classList.toggle("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(t){console.error("Ошибка ".concat(o?"убирания лайка":"постановки лайка"," карточке:"),t)}))}(t._id,l,s)})),s.textContent=t.likes.length,r}function n(t){if("Escape"===t.key){var e=document.querySelector(".popup.popup_is-opened");e&&r(e)}}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",n),m.value=h.textContent,v.value=y.textContent}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function c(t){if(!t.target.closest(".popup__content")){var e=t.target.closest(".popup");e&&r(e)}}t.d({},{gj:()=>u,aW:()=>y,Ou:()=>v,_M:()=>h,Kk:()=>m,rZ:()=>L}),document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){var e=t.closest(".popup");e&&r(e)}))}));var a=function(t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(t){var e=t.nextElementSibling;e.classList.remove("form__input-error_active"),e.textContent="",L.forEach((function(t){t.removeAttribute("disabled","true"),t.classList.remove("popup__button-inactive")}))}(t):function(t,e){var n=t.nextElementSibling;n.classList.add("form__input-error_active"),n.textContent=e,L.forEach((function(t){t.setAttribute("disabled","true"),t.classList.add("popup__button-inactive")}))}(t,t.validationMessage)};function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var u=document.querySelector("#card-template").content,l=document.querySelector(".places__list");Promise.all([fetch("https://nomoreparties.co/v1/wff-cohort-8/users/me",{headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c"}}).then((function(t){if(!t.ok)throw new Error("Ошибка загрузки информации о пользователе: ".concat(t.status));return t.json()})),fetch("https://nomoreparties.co/v1/wff-cohort-8/cards",{headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c"}}).then((function(t){if(!t.ok)throw new Error("Ошибка загрузки карточек: ".concat(t.status));return t.json()}))]).then((function(t){var n,o,r=(o=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(n,o)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];h.textContent=c.name,y.textContent=c.about;var u=c._id;document.querySelector(".profile__image").style.backgroundImage="url('".concat(c.avatar,"')"),a.forEach((function(t){var n=e(t,w,u);l.appendChild(n)}))})).catch((function(t){console.error("Произошла ошибка:",t)}));var s=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),p=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card");s.addEventListener("click",(function(){return o(p)})),d.addEventListener("click",(function(){return o(f)})),p.addEventListener("click",(function(t){return c(t)})),f.addEventListener("click",(function(t){return c(t)})),document.querySelector(".popup_type_image ").addEventListener("click",(function(t){return c(t)}));var _=document.querySelector(".popup__form"),m=document.querySelector(".popup__input_type_name"),v=document.querySelector(".popup__input_type_description"),h=document.querySelector(".profile__title"),y=document.querySelector(".profile__description");_.addEventListener("submit",(function(t){t.preventDefault();var e,n,o=m.value,c=v.value,a=_.querySelector(".popup__button");a.textContent="Сохранение...",(e=o,n=c,fetch("https://nomoreparties.co/v1/wff-cohort-8/users/me",{method:"PATCH",headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c","Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){if(!t.ok)throw new Error("Ошибка при обновлении данных профиля: ".concat(t.status));return t.json()})).catch((function(t){console.error("Произошла ошибка при обновлении данных профиля:",t.message)}))).then((function(t){h.textContent=t.name,y.textContent=t.about,a.textContent="Сохранить",r(p)})).catch((function(t){console.error("Ошибка при обновлении данных профиля:",t),a.textContent="Сохранить"}))})),m.value=h.textContent,v.value=y.textContent;var b=document.querySelector(".popup_type_image"),S=b.querySelector(".popup__content_content_image").querySelector(".popup__image"),E=document.querySelector(".popup__caption"),g=f.querySelector(".popup__form"),q=f.querySelector(".popup__input_type_card-name"),k=f.querySelector(".popup__input_type_url");function w(t,e,n){o(b),S.src=t,S.alt=e,E.textContent=n}g.addEventListener("submit",(function(t,n){t.preventDefault();var o={name:q.value,link:k.value};g.querySelector(".popup__button").textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-8/cards",{method:"POST",headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c","Content-Type":"application/json"},body:JSON.stringify(o)}).then((function(t){if(!t.ok)throw new Error("Ошибка при добавлении новой карточки: ".concat(t.status));return t.json()})).then((function(o){o.owner._id;var c=e(o,w,n);l.insertBefore(c,l.firstChild),r(f),t.target.reset()})).catch((function(t){console.error("Ошибка при добавлении новой карточки:",t)}))}));var C=document.querySelectorAll(".popup__input"),L=(_.querySelector(".".concat(C.id,"-error")),document.querySelectorAll(".popup__button"));_.addEventListener("submit",(function(t){t.preventDefault(),C.forEach((function(t){return a(t)}))})),C.forEach((function(t){t.addEventListener("input",(function(){a(t)}))}));var x=document.getElementById("avatar-form"),j=document.getElementById("avatar-url"),A=document.querySelector(".popup__avatar");document.querySelector(".profile__image").addEventListener("click",(function(){o(A)})),x.addEventListener("submit",(function(t){t.preventDefault();var e,n=j.value,o=x.querySelector(".popup__button");o.textContent="Сохранение...",e=n,fetch("https://nomoreparties.co/v1/wff-cohort-8/users/me/avatar",{method:"PATCH",headers:{authorization:"f0900dc3-fecd-4246-b516-514bd8cfc01c","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){if(!t.ok)throw new Error("Failed to change avatar: ".concat(t.status))})).catch((function(t){console.error("Error changing avatar:",t)})),r(A),o.textContent="Сохранить"}))})();
//# sourceMappingURL=main.js.map